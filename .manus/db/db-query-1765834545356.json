{
  "query": "\n-- Fan Events table\nCREATE TABLE IF NOT EXISTS fan_events (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  fanId INT NOT NULL,\n  artistId INT NOT NULL,\n  eventType ENUM('link_click', 'page_view', 'email_signup', 'email_open', 'email_click', 'stream', 'save', 'follow', 'share', 'comment', 'like', 'merch_view', 'merch_purchase', 'ticket_view', 'ticket_purchase', 'tip', 'referral') NOT NULL,\n  eventSource VARCHAR(100),\n  eventValue INT,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX fan_id_idx (fanId),\n  INDEX artist_id_idx (artistId),\n  INDEX event_type_idx (eventType),\n  INDEX created_at_idx (createdAt),\n  FOREIGN KEY (fanId) REFERENCES fans(id),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n\n-- Smart Links table\nCREATE TABLE IF NOT EXISTS smart_links (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  artistId INT NOT NULL,\n  slug VARCHAR(100) NOT NULL,\n  title VARCHAR(255) NOT NULL,\n  description TEXT,\n  linkType ENUM('release', 'presave', 'bio', 'tour', 'merch', 'custom') NOT NULL,\n  destinations JSON,\n  defaultUrl TEXT,\n  imageUrl TEXT,\n  backgroundColor VARCHAR(7),\n  collectEmail BOOLEAN DEFAULT FALSE NOT NULL,\n  collectPhone BOOLEAN DEFAULT FALSE NOT NULL,\n  showDiscoverySurvey BOOLEAN DEFAULT FALSE NOT NULL,\n  totalClicks INT DEFAULT 0 NOT NULL,\n  uniqueVisitors INT DEFAULT 0 NOT NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX artist_id_idx (artistId),\n  INDEX slug_idx (slug),\n  INDEX link_type_idx (linkType),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n\n-- Link Clicks table\nCREATE TABLE IF NOT EXISTS link_clicks (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  linkId INT NOT NULL,\n  fanId INT,\n  destination VARCHAR(50),\n  utmSource VARCHAR(100),\n  utmMedium VARCHAR(100),\n  utmCampaign VARCHAR(100),\n  utmContent VARCHAR(100),\n  referrer TEXT,\n  device VARCHAR(50),\n  browser VARCHAR(50),\n  os VARCHAR(50),\n  country VARCHAR(2),\n  city VARCHAR(100),\n  ipHash VARCHAR(64),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX link_id_idx (linkId),\n  INDEX fan_id_idx (fanId),\n  INDEX utm_source_idx (utmSource),\n  INDEX created_at_idx (createdAt),\n  FOREIGN KEY (linkId) REFERENCES smart_links(id),\n  FOREIGN KEY (fanId) REFERENCES fans(id)\n);\n\n-- Fan Segments table\nCREATE TABLE IF NOT EXISTS fan_segments (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  artistId INT NOT NULL,\n  name VARCHAR(100) NOT NULL,\n  description TEXT,\n  rules JSON,\n  fanCount INT DEFAULT 0 NOT NULL,\n  lastComputedAt TIMESTAMP NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX artist_id_idx (artistId),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n\n-- Funnel Snapshots table\nCREATE TABLE IF NOT EXISTS funnel_snapshots (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  artistId INT NOT NULL,\n  snapshotDate TIMESTAMP NOT NULL,\n  discoveredCount INT DEFAULT 0 NOT NULL,\n  followerCount INT DEFAULT 0 NOT NULL,\n  engagedCount INT DEFAULT 0 NOT NULL,\n  customerCount INT DEFAULT 0 NOT NULL,\n  superfanCount INT DEFAULT 0 NOT NULL,\n  discoveredToFollower INT,\n  followerToEngaged INT,\n  engagedToCustomer INT,\n  customerToSuperfan INT,\n  sourceBreakdown JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX artist_date_idx (artistId, snapshotDate),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2SKEMaxYovcAzrR.root --database nTbKjjzazhRpeJn9kKuXdQ --execute \n-- Fan Events table\nCREATE TABLE IF NOT EXISTS fan_events (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  fanId INT NOT NULL,\n  artistId INT NOT NULL,\n  eventType ENUM('link_click', 'page_view', 'email_signup', 'email_open', 'email_click', 'stream', 'save', 'follow', 'share', 'comment', 'like', 'merch_view', 'merch_purchase', 'ticket_view', 'ticket_purchase', 'tip', 'referral') NOT NULL,\n  eventSource VARCHAR(100),\n  eventValue INT,\n  metadata JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX fan_id_idx (fanId),\n  INDEX artist_id_idx (artistId),\n  INDEX event_type_idx (eventType),\n  INDEX created_at_idx (createdAt),\n  FOREIGN KEY (fanId) REFERENCES fans(id),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n\n-- Smart Links table\nCREATE TABLE IF NOT EXISTS smart_links (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  artistId INT NOT NULL,\n  slug VARCHAR(100) NOT NULL,\n  title VARCHAR(255) NOT NULL,\n  description TEXT,\n  linkType ENUM('release', 'presave', 'bio', 'tour', 'merch', 'custom') NOT NULL,\n  destinations JSON,\n  defaultUrl TEXT,\n  imageUrl TEXT,\n  backgroundColor VARCHAR(7),\n  collectEmail BOOLEAN DEFAULT FALSE NOT NULL,\n  collectPhone BOOLEAN DEFAULT FALSE NOT NULL,\n  showDiscoverySurvey BOOLEAN DEFAULT FALSE NOT NULL,\n  totalClicks INT DEFAULT 0 NOT NULL,\n  uniqueVisitors INT DEFAULT 0 NOT NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX artist_id_idx (artistId),\n  INDEX slug_idx (slug),\n  INDEX link_type_idx (linkType),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n\n-- Link Clicks table\nCREATE TABLE IF NOT EXISTS link_clicks (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  linkId INT NOT NULL,\n  fanId INT,\n  destination VARCHAR(50),\n  utmSource VARCHAR(100),\n  utmMedium VARCHAR(100),\n  utmCampaign VARCHAR(100),\n  utmContent VARCHAR(100),\n  referrer TEXT,\n  device VARCHAR(50),\n  browser VARCHAR(50),\n  os VARCHAR(50),\n  country VARCHAR(2),\n  city VARCHAR(100),\n  ipHash VARCHAR(64),\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX link_id_idx (linkId),\n  INDEX fan_id_idx (fanId),\n  INDEX utm_source_idx (utmSource),\n  INDEX created_at_idx (createdAt),\n  FOREIGN KEY (linkId) REFERENCES smart_links(id),\n  FOREIGN KEY (fanId) REFERENCES fans(id)\n);\n\n-- Fan Segments table\nCREATE TABLE IF NOT EXISTS fan_segments (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  artistId INT NOT NULL,\n  name VARCHAR(100) NOT NULL,\n  description TEXT,\n  rules JSON,\n  fanCount INT DEFAULT 0 NOT NULL,\n  lastComputedAt TIMESTAMP NULL,\n  isActive BOOLEAN DEFAULT TRUE NOT NULL,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL,\n  INDEX artist_id_idx (artistId),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n\n-- Funnel Snapshots table\nCREATE TABLE IF NOT EXISTS funnel_snapshots (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  artistId INT NOT NULL,\n  snapshotDate TIMESTAMP NOT NULL,\n  discoveredCount INT DEFAULT 0 NOT NULL,\n  followerCount INT DEFAULT 0 NOT NULL,\n  engagedCount INT DEFAULT 0 NOT NULL,\n  customerCount INT DEFAULT 0 NOT NULL,\n  superfanCount INT DEFAULT 0 NOT NULL,\n  discoveredToFollower INT,\n  followerToEngaged INT,\n  engagedToCustomer INT,\n  customerToSuperfan INT,\n  sourceBreakdown JSON,\n  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  INDEX artist_date_idx (artistId, snapshotDate),\n  FOREIGN KEY (artistId) REFERENCES artist_profiles(id)\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 1355
}