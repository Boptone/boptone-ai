{
  "query": "CREATE TABLE IF NOT EXISTS `distribution_platforms` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `name` varchar(100) NOT NULL,\n  `slug` varchar(100) NOT NULL UNIQUE,\n  `logoUrl` text,\n  `apiEndpoint` text,\n  `isActive` boolean NOT NULL DEFAULT true,\n  `requiresIsrc` boolean NOT NULL DEFAULT true,\n  `requiresUpc` boolean NOT NULL DEFAULT false,\n  `supportsPrerelease` boolean NOT NULL DEFAULT true,\n  `description` text,\n  `websiteUrl` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS `track_distributions` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `trackId` int NOT NULL,\n  `platformId` int NOT NULL,\n  `status` enum('pending', 'processing', 'live', 'failed', 'takedown') NOT NULL DEFAULT 'pending',\n  `platformTrackId` varchar(255),\n  `platformUrl` text,\n  `releaseDate` timestamp,\n  `publishedAt` timestamp,\n  `totalStreams` int NOT NULL DEFAULT 0,\n  `totalEarnings` int NOT NULL DEFAULT 0,\n  `errorMessage` text,\n  `retryCount` int NOT NULL DEFAULT 0,\n  `lastAttemptAt` timestamp,\n  `distributionMetadata` json,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`trackId`) REFERENCES `bap_tracks`(`id`),\n  FOREIGN KEY (`platformId`) REFERENCES `distribution_platforms`(`id`),\n  INDEX `track_id_idx` (`trackId`),\n  INDEX `platform_id_idx` (`platformId`),\n  INDEX `status_idx` (`status`),\n  UNIQUE INDEX `unique_track_platform` (`trackId`, `platformId`)\n);\n\nCREATE TABLE IF NOT EXISTS `distribution_revenue` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `trackDistributionId` int NOT NULL,\n  `periodStart` timestamp NOT NULL,\n  `periodEnd` timestamp NOT NULL,\n  `streams` int NOT NULL,\n  `grossRevenue` int NOT NULL,\n  `platformFee` int NOT NULL,\n  `boptoneFee` int NOT NULL,\n  `artistRevenue` int NOT NULL,\n  `boptoneSharePercent` decimal(5, 2) NOT NULL,\n  `payoutStatus` enum('pending', 'processing', 'paid', 'failed') NOT NULL DEFAULT 'pending',\n  `paidAt` timestamp,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`trackDistributionId`) REFERENCES `track_distributions`(`id`),\n  INDEX `track_distribution_id_idx` (`trackDistributionId`),\n  INDEX `period_idx` (`periodStart`, `periodEnd`)\n);\n\nINSERT INTO `distribution_platforms` (`name`, `slug`, `logoUrl`, `websiteUrl`, `description`) VALUES\n('Spotify', 'spotify', 'https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_RGB_Green.png', 'https://spotify.com', 'World''s largest music streaming platform'),\n('Apple Music', 'apple_music', 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Apple_Music_logo.svg/512px-Apple_Music_logo.svg.png', 'https://music.apple.com', 'Apple''s music streaming service'),\n('Tidal', 'tidal', 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Tidal_logo.svg/512px-Tidal_logo.svg.png', 'https://tidal.com', 'High-fidelity music streaming'),\n('Deezer', 'deezer', 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Deezer_logo.svg/512px-Deezer_logo.svg.png', 'https://deezer.com', 'Global music streaming platform'),\n('YouTube Music', 'youtube_music', 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Youtube_Music_icon.svg/512px-Youtube_Music_icon.svg.png', 'https://music.youtube.com', 'YouTube''s music streaming service'),\n('Amazon Music', 'amazon_music', 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/74/Amazon_Music_logo.svg/512px-Amazon_Music_logo.svg.png', 'https://music.amazon.com', 'Amazon''s music streaming platform'),\n('Pandora', 'pandora', 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Pandora_wordmark.svg/512px-Pandora_wordmark.svg.png', 'https://pandora.com', 'Personalized internet radio'),\n('SoundCloud', 'soundcloud', 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Soundcloud_logo.svg/512px-Soundcloud_logo.svg.png', 'https://soundcloud.com', 'Audio distribution platform')\nON DUPLICATE KEY UPDATE `name` = VALUES(`name`);",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 2SKEMaxYovcAzrR.root --database nTbKjjzazhRpeJn9kKuXdQ --execute CREATE TABLE IF NOT EXISTS `distribution_platforms` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `name` varchar(100) NOT NULL,\n  `slug` varchar(100) NOT NULL UNIQUE,\n  `logoUrl` text,\n  `apiEndpoint` text,\n  `isActive` boolean NOT NULL DEFAULT true,\n  `requiresIsrc` boolean NOT NULL DEFAULT true,\n  `requiresUpc` boolean NOT NULL DEFAULT false,\n  `supportsPrerelease` boolean NOT NULL DEFAULT true,\n  `description` text,\n  `websiteUrl` text,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP\n);\n\nCREATE TABLE IF NOT EXISTS `track_distributions` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `trackId` int NOT NULL,\n  `platformId` int NOT NULL,\n  `status` enum('pending', 'processing', 'live', 'failed', 'takedown') NOT NULL DEFAULT 'pending',\n  `platformTrackId` varchar(255),\n  `platformUrl` text,\n  `releaseDate` timestamp,\n  `publishedAt` timestamp,\n  `totalStreams` int NOT NULL DEFAULT 0,\n  `totalEarnings` int NOT NULL DEFAULT 0,\n  `errorMessage` text,\n  `retryCount` int NOT NULL DEFAULT 0,\n  `lastAttemptAt` timestamp,\n  `distributionMetadata` json,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`trackId`) REFERENCES `bap_tracks`(`id`),\n  FOREIGN KEY (`platformId`) REFERENCES `distribution_platforms`(`id`),\n  INDEX `track_id_idx` (`trackId`),\n  INDEX `platform_id_idx` (`platformId`),\n  INDEX `status_idx` (`status`),\n  UNIQUE INDEX `unique_track_platform` (`trackId`, `platformId`)\n);\n\nCREATE TABLE IF NOT EXISTS `distribution_revenue` (\n  `id` int AUTO_INCREMENT PRIMARY KEY,\n  `trackDistributionId` int NOT NULL,\n  `periodStart` timestamp NOT NULL,\n  `periodEnd` timestamp NOT NULL,\n  `streams` int NOT NULL,\n  `grossRevenue` int NOT NULL,\n  `platformFee` int NOT NULL,\n  `boptoneFee` int NOT NULL,\n  `artistRevenue` int NOT NULL,\n  `boptoneSharePercent` decimal(5, 2) NOT NULL,\n  `payoutStatus` enum('pending', 'processing', 'paid', 'failed') NOT NULL DEFAULT 'pending',\n  `paidAt` timestamp,\n  `createdAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  `updatedAt` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n  FOREIGN KEY (`trackDistributionId`) REFERENCES `track_distributions`(`id`),\n  INDEX `track_distribution_id_idx` (`trackDistributionId`),\n  INDEX `period_idx` (`periodStart`, `periodEnd`)\n);\n\nINSERT INTO `distribution_platforms` (`name`, `slug`, `logoUrl`, `websiteUrl`, `description`) VALUES\n('Spotify', 'spotify', 'https://storage.googleapis.com/pr-newsroom-wp/1/2018/11/Spotify_Logo_RGB_Green.png', 'https://spotify.com', 'World''s largest music streaming platform'),\n('Apple Music', 'apple_music', 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2a/Apple_Music_logo.svg/512px-Apple_Music_logo.svg.png', 'https://music.apple.com', 'Apple''s music streaming service'),\n('Tidal', 'tidal', 'https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Tidal_logo.svg/512px-Tidal_logo.svg.png', 'https://tidal.com', 'High-fidelity music streaming'),\n('Deezer', 'deezer', 'https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Deezer_logo.svg/512px-Deezer_logo.svg.png', 'https://deezer.com', 'Global music streaming platform'),\n('YouTube Music', 'youtube_music', 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/6a/Youtube_Music_icon.svg/512px-Youtube_Music_icon.svg.png', 'https://music.youtube.com', 'YouTube''s music streaming service'),\n('Amazon Music', 'amazon_music', 'https://upload.wikimedia.org/wikipedia/commons/thumb/7/74/Amazon_Music_logo.svg/512px-Amazon_Music_logo.svg.png', 'https://music.amazon.com', 'Amazon''s music streaming platform'),\n('Pandora', 'pandora', 'https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Pandora_wordmark.svg/512px-Pandora_wordmark.svg.png', 'https://pandora.com', 'Personalized internet radio'),\n('SoundCloud', 'soundcloud', 'https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Soundcloud_logo.svg/512px-Soundcloud_logo.svg.png', 'https://soundcloud.com', 'Audio distribution platform')\nON DUPLICATE KEY UPDATE `name` = VALUES(`name`);",
  "returncode": 1,
  "logs": [
    "ERROR 1824 (HY000) at line 17: Failed to open the referenced table 'bap_tracks'"
  ]
}